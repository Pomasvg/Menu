<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–®–∫—ñ–ª—å–Ω–µ –º–µ–Ω—é</title>
  <style>
    :root{--bg:#f7fbff;--card:#ffffff;--accent:#0066cc;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter,Segoe UI,Arial; background:var(--bg); margin:0; padding:24px; color:#0f172a}
    .wrap{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;gap:12px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(0,102,204,0.12)}
    button:disabled{opacity:0.6;cursor:not-allowed}
    .date-display{font-weight:700}
    .card{background:var(--card);border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(12,18,40,0.06)}
    .section-title{font-weight:700;margin-top:14px;margin-bottom:8px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .meal{padding:12px;border-radius:8px;background:#fbfdff;border:1px solid rgba(11,56,110,0.04)}
    .meal h4{margin:0 0 6px 0;font-size:15px}
    .muted{color:var(--muted);font-size:13px}
    .form-row{margin-top:8px}
    textarea,input[type="text"]{width:100%;padding:8px;border-radius:6px;border:1px solid #e6eef8;font-size:14px}
    .status{padding:4px 8px;border-radius:4px;font-size:12px;margin-left:8px}
    .success{background:#d4edda;color:#155724}
    .loading{background:#fff3cd;color:#856404}
    .error{background:#f8d7da;color:#721c24}
    .access-panel{background:#f8f9fa;padding:15px;border-radius:8px;margin-top:15px;border:1px dashed #ccc}
    .user-badge{background:#e7f3ff;padding:4px 8px;border-radius:4px;font-size:12px;margin-left:8px}
    .admin-section{margin-top:30px;padding-top:20px;border-top:1px solid #e6eef8}
    /* üëá –î–û–î–ê–í –ù–û–í–ò–ô –°–¢–ò–õ–¨ –î–õ–Ø –ê–ë–ó–ê–¶–Ü–í */
    .meal-content {
      white-space: pre-line; /* –ó–±–µ—Ä—ñ–≥–∞—î –ø–µ—Ä–µ–Ω–æ—Å–∏ —Ä—è–¥–∫—ñ–≤ */
      line-height: 1.5;
    }
    .meal-content ol, .meal-content ul {
      margin: 0;
      padding-left: 20px;
    }
    .meal-content li {
      margin-bottom: 4px;
    }
    @media(max-width:520px){header{flex-direction:column;align-items:flex-start}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>üçΩÔ∏è –®–∫—ñ–ª—å–Ω–µ –º–µ–Ω—é</h1>
        <div class="muted small">–ü–æ–∫–∞–∑–∞–Ω–æ –º–µ–Ω—é –Ω–∞ <span id="readableDate">...</span> <span id="status" class="status"></span></div>
      </div>
      <div class="controls">
        <button id="prev" class="ghost">‚Üê</button>
        <input type="date" id="date" />
        <button id="next" class="ghost">‚Üí</button>
        <button id="today">–°—å–æ–≥–æ–¥–Ω—ñ</button>
        <button id="refresh">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
        <button id="adminToggle" class="ghost">‚öôÔ∏è –î–ª—è –∞–¥–º—ñ–Ω–∞</button>
        <span id="userBadge" class="user-badge" style="display:none">üë§ –ê–¥–º—ñ–Ω</span>
      </div>
    </header>

    <main class="card">
      <div class="section-title">üè´ –ú—ñ—Å—å–∫—ñ –¥—ñ—Ç–∏</div>
      <div id="cityArea" class="grid" aria-live="polite"></div>

      <div class="section-title">üè† –Ü–Ω–æ–≥–æ—Ä–æ–¥–Ω—ñ –¥—ñ—Ç–∏</div>
      <div id="nonCityArea" class="grid" aria-live="polite"></div>

      <div class="admin-section">
        <div style="text-align:center;margin-bottom:15px;">
          <button id="toggleAdminPanel" class="ghost" style="font-size:12px;">üë®‚Äçüè´ –†–æ–∑–¥—ñ–ª –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
        </div>
        
        <div id="accessPanel" class="access-panel" style="display:none">
          <h3>üîê –î–æ—Å—Ç—É–ø –¥–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</h3>
          <div class="form-row">
            <label>–ü–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
            <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" style="width:100%" />
          </div>
          <button id="loginBtn">üîì –£–≤—ñ–π—Ç–∏</button>
          <div class="muted" style="margin-top:8px;font-size:12px">
            –°–∞–π—Ç –ø—Ä–∏–≤–∞—Ç–Ω–∏–π. –ü–∞—Ä–æ–ª—å –Ω–µ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –Ω–∞–≤—ñ—Ç—å –ø—ñ–¥ —Ç–∏—Å–∫–æ–º
          </div>
        </div>

        <div id="editor" style="display:none;margin-top:20px;padding:20px;background:#f8f9fa;border-radius:8px;">
          <h3>‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –º–µ–Ω—é –Ω–∞ <span id="editDateLabel"></span></h3>
          
          <div class="muted" style="margin-bottom:15px;">
            üí° <strong>–Ø–∫ —Ä–æ–±–∏—Ç–∏ –∞–±–∑–∞—Ü–∏:</strong><br>
            ‚Ä¢ –ü—Ä–æ—Å—Ç–æ –Ω–∞—Ç–∏—Å–∫–∞–π—Ç–µ Enter –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞<br>
            ‚Ä¢ –î–ª—è —Å–ø–∏—Å–∫—ñ–≤ –ø–∏—à—ñ—Ç—å: 1. ...<br>2. ...<br>3. ...<br>
            ‚Ä¢ –ê–±–∑–∞—Ü–∏ –±—É–¥—É—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω—ñ
          </div>
          
          <div class="section-title">üçΩÔ∏è –ú—ñ—Å—å–∫—ñ –¥—ñ—Ç–∏</div>
          <div class="form-row"><label>üç≤ –û–±—ñ–¥</label><textarea id="e_city_lunch" rows="6" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥:
1. –ë–æ—Ä—â –∑—ñ —Å–º–µ—Ç–∞–Ω–æ—é
2. –ö–æ—Ç–ª–µ—Ç–∞ –∫—É—Ä—è—á–∞
3. –ü—é—Ä–µ –∫–∞—Ä—Ç–æ–ø–ª—è–Ω–µ
4. –ö–æ–º–ø–æ—Ç –∑ —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ñ–≤"></textarea></div>

          <div class="section-title">üè† –Ü–Ω–æ–≥–æ—Ä–æ–¥–Ω—ñ –¥—ñ—Ç–∏</div>
          <div class="form-row"><label>üç≥ –°–Ω—ñ–¥–∞–Ω–æ–∫</label><textarea id="e_nc_breakfast" rows="4" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥:
‚Ä¢ –ö–∞—à–∞ –≥—Ä–µ—á–∞–Ω–∞ –∑ –º–æ–ª–æ–∫–æ–º
‚Ä¢ –ë—É—Ç–µ—Ä–±—Ä–æ–¥ –∑ —Å–∏—Ä–æ–º
‚Ä¢ –ß–∞–π –∑ –ª–∏–º–æ–Ω–æ–º"></textarea></div>
          <div class="form-row"><label>üçé –ü–æ–ª—É–¥–µ–Ω–æ–∫</label><textarea id="e_nc_snack" rows="4" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥:
1. –Ø–±–ª—É–∫–æ
2. –ü–µ—á–∏–≤–æ
3. –°—ñ–∫ —è–±–ª—É—á–Ω–∏–π"></textarea></div>
          <div class="form-row"><label>üç≤ –û–±—ñ–¥</label><textarea id="e_nc_lunch" rows="6" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥:
–ü–µ—Ä—à–µ: –ë–æ—Ä—â
–î—Ä—É–≥–µ: –ö–æ—Ç–ª–µ—Ç–∞ –∑ –ø—é—Ä–µ
–°–∞–ª–∞—Ç: –û–≤–æ—á–µ–≤–∏–π
–ù–∞–ø—ñ–π: –ö–æ–º–ø–æ—Ç"></textarea></div>
          <div class="form-row"><label>ü•õ –ü—ñ–¥–≤–µ—á—ñ—Ä–æ–∫</label><textarea id="e_nc_evening" rows="4" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥:
- –ô–æ–≥—É—Ä—Ç –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∏–π
- –ë–∞–Ω–∞–Ω
- –ß–∞–π —Ç—Ä–∞–≤'—è–Ω–∏–π"></textarea></div>
          <div class="form-row"><label>üçõ –í–µ—á–µ—Ä—è</label><textarea id="e_nc_dinner" rows="4" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥:
–û–º–ª–µ—Ç –∑ –ø–æ–º—ñ–¥–æ—Ä–∞–º–∏
–°–∞–ª–∞—Ç –∑ –æ–≥—ñ—Ä–∫—ñ–≤
–ö–µ—Ñ—ñ—Ä"></textarea></div>

          <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;">
            <button id="save">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö</button>
            <button id="cancel" class="ghost">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const ADMIN_PASSWORD = "school123123";
    const GITHUB_CONFIG = {
      repoOwner: "Pomasvg",       
      repoName: "menu"
    };

    let currentData = {};
    let isAdmin = false;
    let githubToken = "";

    const dateInput = document.getElementById('date');
    const readableDate = document.getElementById('readableDate');
    const cityArea = document.getElementById('cityArea');
    const nonCityArea = document.getElementById('nonCityArea');
    const editor = document.getElementById('editor');
    const statusEl = document.getElementById('status');
    const accessPanel = document.getElementById('accessPanel');
    const userBadge = document.getElementById('userBadge');

    function isoToday() { return new Date().toISOString().slice(0,10); }
    function niceDate(iso) { return new Date(iso).toLocaleDateString('uk-UA',{year:'numeric',month:'long',day:'numeric'}); }

    function setStatus(text, type = '') {
      statusEl.textContent = text;
      statusEl.className = `status ${type}`;
    }

    // üëá –§–£–ù–ö–¶–Ü–Ø –î–õ–Ø –ö–û–ù–í–ï–†–¢–ê–¶–Ü–á –¢–ï–ö–°–¢–£ –ó –ê–ë–ó–ê–¶–ê–ú–ò
    function formatMenuText(text) {
      if (!text) return '‚Äî';
      
      // –ó–∞–º—ñ–Ω—é—î–º–æ "1.", "2." —ñ —Ç.–¥. –Ω–∞ —Å–ø–∏—Å–æ–∫
      let formatted = text
        .replace(/^(\d+\.)\s/gm, '<li>$1 ') // –ó–Ω–∞—Ö–æ–¥–∏—Ç—å "1. —Ç–µ–∫—Å—Ç" –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ä—è–¥–∫–∞
        .replace(/(\n|^)(‚Ä¢|-)\s/gm, '$1<li>$2 '); // –ó–Ω–∞—Ö–æ–¥–∏—Ç—å "‚Ä¢ —Ç–µ–∫—Å—Ç" –∞–±–æ "- —Ç–µ–∫—Å—Ç"
      
      // –Ø–∫—â–æ —î <li>, –æ–±–≥–æ—Ä—Ç–∞—î–º–æ –≤ <ol> –∞–±–æ <ul>
      if (formatted.includes('<li>')) {
        // –í–∏–∑–Ω–∞—á–∞—î–º–æ —á–∏ —Ü–µ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ (1., 2.) —á–∏ –º–∞—Ä–∫–æ–≤–∞–Ω–∏–π (‚Ä¢, -)
        const isNumbered = text.match(/^\d+\./m);
        const listTag = isNumbered ? 'ol' : 'ul';
        formatted = `<${listTag}>${formatted}</${listTag}>`;
        
        // –ó–∞–º—ñ–Ω—é—î–º–æ –ø–µ—Ä–µ–Ω–æ—Å–∏ –º—ñ–∂ –ø—É–Ω–∫—Ç–∞–º–∏ —Å–ø–∏—Å–∫—É
        formatted = formatted.replace(/<\/li>\s*<li>/g, '</li><li>');
      }
      
      return formatted;
    }

    // üëá –û–ù–û–í–õ–ï–ù–ê –§–£–ù–ö–¶–Ü–Ø –î–õ–Ø –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –ú–ï–ù–Æ
    function renderForDate(iso) {
      if (!iso) iso = dateInput.value || isoToday();
      readableDate.textContent = niceDate(iso);
      const day = currentData[iso] || { city: { lunch: '' }, nonCity: { breakfast:'', snack:'', lunch:'', evening:'', dinner:'' } };

      cityArea.innerHTML = '';
      const cityLunchCard = document.createElement('div');
      cityLunchCard.className = 'meal';
      const cityLunchContent = formatMenuText(day.city.lunch);
      cityLunchCard.innerHTML = `<h4>üçΩÔ∏è –û–±—ñ–¥</h4><div class="meal-content">${cityLunchContent || '‚Äî'}</div>`;
      cityArea.appendChild(cityLunchCard);

      nonCityArea.innerHTML = '';
      const fields = [
        ['üç≥ –°–Ω—ñ–¥–∞–Ω–æ–∫', day.nonCity.breakfast],
        ['üçé –ü–æ–ª—É–¥–µ–Ω–æ–∫', day.nonCity.snack],
        ['üç≤ –û–±—ñ–¥', day.nonCity.lunch],
        ['ü•õ –ü—ñ–¥–≤–µ—á—ñ—Ä–æ–∫', day.nonCity.evening],
        ['üçõ –í–µ—á–µ—Ä—è', day.nonCity.dinner]
      ];
      
      fields.forEach(([title, val]) => {
        const div = document.createElement('div');
        div.className = 'meal';
        const content = formatMenuText(val);
        div.innerHTML = `<h4>${title}</h4><div class="meal-content">${content || '‚Äî'}</div>`;
        nonCityArea.appendChild(div);
      });
    }

    function utf8_to_b64(str) {
      return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function(match, p1) {
        return String.fromCharCode('0x' + p1);
      }));
    }

    async function getGitHubToken() {
      if (githubToken) return githubToken;
      
      const savedToken = localStorage.getItem('github_token');
      if (savedToken) {
        githubToken = savedToken;
        return savedToken;
      }
      
      const token = prompt('üîê –°—é–¥–∏ –≤–≤–µ–¥–∏ —Ç–æ–∫–µ–Ω');
      if (token) {
        const isValid = await validateToken(token);
        if (isValid) {
          githubToken = token;
          localStorage.setItem('github_token', token);
          return token;
        } else {
          alert('‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π —Ç–æ–∫–µ–Ω! –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É.');
          localStorage.removeItem('github_token');
          return null;
        }
      }
      
      return null;
    }

    async function validateToken(token) {
      try {
        const response = await fetch('https://api.github.com/user', {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        return response.ok;
      } catch (error) {
        return false;
      }
    }

    async function loadData() {
      setStatus('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', 'loading');
      try {
        const url = `https://raw.githubusercontent.com/${GITHUB_CONFIG.repoOwner}/${GITHUB_CONFIG.repoName}/main/menu.json`;
        const response = await fetch(url + '?t=' + Date.now());
        
        if (response.ok) {
          const content = await response.json();
          currentData = content;
          setStatus('–û–Ω–æ–≤–ª–µ–Ω–æ', 'success');
          setTimeout(() => setStatus(''), 3000);
          return true;
        } else if (response.status === 404) {
          currentData = {};
          setStatus('–ú–µ–Ω—é —â–µ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–µ', 'success');
          return true;
        } else {
          throw new Error(`–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ${response.status}`);
        }
      } catch (error) {
        setStatus('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', 'error');
        console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        return false;
      }
    }

    async function saveData() {
      const token = await getGitHubToken();
      if (!token) {
        setStatus('–ü–æ—Ç—Ä—ñ–±–µ–Ω —Ç–æ–∫–µ–Ω –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è', 'error');
        return false;
      }

      setStatus('–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...', 'loading');
      try {
        const url = `https://api.github.com/repos/${GITHUB_CONFIG.repoOwner}/${GITHUB_CONFIG.repoName}/contents/menu.json`;
        
        let sha = '';
        try {
          const getResponse = await fetch(url, {
            headers: {
              'Authorization': `token ${token}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          });
          
          if (getResponse.status === 401) {
            throw new Error('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ç–æ–∫–µ–Ω. –°–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω –∑–Ω–æ–≤—É.');
          }
          
          if (getResponse.ok) {
            const fileData = await getResponse.json();
            sha = fileData.sha;
          } else if (getResponse.status !== 404) {
            throw new Error(`–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–∞–π–ª—É: ${getResponse.status}`);
          }
        } catch (error) {
          if (error.message.includes('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ç–æ–∫–µ–Ω')) {
            localStorage.removeItem('github_token');
            githubToken = "";
            throw error;
          }
          if (!error.message.includes('404')) {
            throw error;
          }
        }

        const jsonString = JSON.stringify(currentData, null, 2);
        const content = utf8_to_b64(jsonString);
        
        const response = await fetch(url, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: `–û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–µ–Ω—é –∑–∞ ${dateInput.value}`,
            content: content,
            sha: sha || undefined
          })
        });

        if (response.ok) {
          setStatus('–ó–±–µ—Ä–µ–∂–µ–Ω–æ –¥–ª—è –≤—Å—ñ—Ö!', 'success');
          setTimeout(() => setStatus(''), 3000);
          return true;
        } else {
          const errorData = await response.json();
          
          if (response.status === 401) {
            localStorage.removeItem('github_token');
            githubToken = "";
            throw new Error('–¢–æ–∫–µ–Ω –Ω–µ–¥—ñ–π—Å–Ω–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤–∏–π —Ç–æ–∫–µ–Ω.');
          } else if (response.status === 403) {
            throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–∞–≤. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —Ç–æ–∫–µ–Ω –º–∞—î –ø—Ä–∞–≤–∞ "repo".');
          } else if (response.status === 404) {
            throw new Error('–†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ repoOwner —Ç–∞ repoName.');
          } else {
            throw new Error(errorData.message || `–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ${response.status}`);
          }
        }
      } catch (error) {
        setStatus(`–ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', error);
        
        if (error.message.includes('—Ç–æ–∫–µ–Ω') || error.message.includes('–ø—Ä–∞–≤')) {
          setTimeout(() => {
            localStorage.removeItem('github_token');
            githubToken = "";
            getGitHubToken();
          }, 2000);
        }
        
        return false;
      }
    }

    document.getElementById('today').addEventListener('click', () => {
      dateInput.value = isoToday();
      renderForDate(dateInput.value);
    });

    document.getElementById('prev').addEventListener('click', () => changeDateBy(-1));
    document.getElementById('next').addEventListener('click', () => changeDateBy(1));
    document.getElementById('refresh').addEventListener('click', () => loadData().then(() => renderForDate(dateInput.value)));

    function changeDateBy(delta) {
      const cur = new Date(dateInput.value || isoToday());
      cur.setDate(cur.getDate() + delta);
      const iso = cur.toISOString().slice(0,10);
      dateInput.value = iso;
      renderForDate(iso);
    }

    dateInput.addEventListener('change', () => renderForDate(dateInput.value));

    document.getElementById('toggleAdminPanel').addEventListener('click', () => {
      accessPanel.style.display = accessPanel.style.display === 'none' ? 'block' : 'none';
    });

    document.getElementById('adminToggle').addEventListener('click', () => {
      document.querySelector('.admin-section').scrollIntoView({ behavior: 'smooth' });
      accessPanel.style.display = 'block';
    });

    document.getElementById('loginBtn').addEventListener('click', () => {
      const password = document.getElementById('adminPassword').value;
      if (password === ADMIN_PASSWORD) {
        isAdmin = true;
        accessPanel.style.display = 'none';
        userBadge.style.display = 'inline-block';
        document.getElementById('adminToggle').textContent = '‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏';
        alert('‚úÖ –í–∏ —É–≤—ñ–π—à–ª–∏ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä! –¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –º–µ–Ω—é.');
      } else {
        alert('‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å! –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —à–∫–æ–ª–∏.');
      }
    });

    document.getElementById('adminToggle').addEventListener('click', () => {
      if (!isAdmin) {
        document.querySelector('.admin-section').scrollIntoView({ behavior: 'smooth' });
        accessPanel.style.display = 'block';
        return;
      }
      openEditorFor(dateInput.value || isoToday());
    });

    function openEditorFor(iso) {
      const day = currentData[iso] || { city: { lunch: '' }, nonCity: { breakfast:'', snack:'', lunch:'', evening:'', dinner:'' } };
      
      document.getElementById('e_city_lunch').value = day.city.lunch || '';
      document.getElementById('e_nc_breakfast').value = day.nonCity.breakfast || '';
      document.getElementById('e_nc_snack').value = day.nonCity.snack || '';
      document.getElementById('e_nc_lunch').value = day.nonCity.lunch || '';
      document.getElementById('e_nc_evening').value = day.nonCity.evening || '';
      document.getElementById('e_nc_dinner').value = day.nonCity.dinner || '';
      document.getElementById('editDateLabel').textContent = niceDate(iso);
      editor.style.display = 'block';
      editor.scrollIntoView({ behavior: 'smooth' });
    }

    document.getElementById('cancel').addEventListener('click', () => {
      editor.style.display = 'none';
    });

    document.getElementById('save').addEventListener('click', async () => {
      const iso = dateInput.value || isoToday();
      
      currentData[iso] = {
        city: { lunch: document.getElementById('e_city_lunch').value.trim() },
        nonCity: {
          breakfast: document.getElementById('e_nc_breakfast').value.trim(),
          snack: document.getElementById('e_nc_snack').value.trim(),
          lunch: document.getElementById('e_nc_lunch').value.trim(),
          evening: document.getElementById('e_nc_evening').value.trim(),
          dinner: document.getElementById('e_nc_dinner').value.trim()
        }
      };

      const success = await saveData();
      if (success) {
        renderForDate(iso);
        editor.style.display = 'none';
      }
    });

    setInterval(() => {
      loadData().then(() => renderForDate(dateInput.value));
    }, 60000);

    (async function init() {
      dateInput.value = isoToday();
      await loadData();
      renderForDate(dateInput.value);
    })();
  </script>
</body>
</html>
